# شبكة عُقدة – الوثيقة التقنية

**الإصدار 1.0**  
يناير 2026

---

## الملخص التنفيذي

شبكة عُقدة هي بروتوكول توجيه لامركزي مصمم لبناء شبكات mesh متعددة القفزات مرنة وذاتية التنظيم مع تشفير من طرف إلى طرف، وإعدادات دنيا، واستقلالية عن البنية التحتية المركزية.

المبنية على بدائيات تشفير مثبتة وخوارزميات توجيه مبتكرة، تمكن عُقدة من الاتصال المباشر بين الأقران عبر طوبولوجيات شبكية ديناميكية مع الحفاظ على عنونة مستقرة ومستقلة عن الموقع من خلال IPv6.

تقدم هذه الوثيقة البنية التقنية، ومبادئ التصميم، والتحسينات العملية التي تميز عُقدة كحل عملي لتحديات الشبكات اللامركزية الحديثة.

---

## 1. المقدمة

### 1.1 الدافع

تواجه البنية التحتية للشبكة المعاصرة تحديات أساسية:

- **المركزية**: الاعتماد الكبير على مزودي خدمة الإنترنت، وتدرجات توجيه BGP، وهندسة الأنظمة المستقلة
- **تعقيد الإعداد**: متطلبات الإعداد اليدوي التي لا تتوسع بشكل جيد
- **جمود الطوبولوجيا**: تكيف ضعيف مع ظروف الشبكة الديناميكية أو المؤقتة
- **الاعتماد على البنية التحتية**: عدم القدرة على العمل بدون اتصال إنترنت موجود

حالات الاستخدام الناشئة تتطلب خصائص مختلفة:

- شبكات mesh يديرها المجتمع
- الحوسبة الطرفية مع اتصال مباشر بين الأجهزة
- شبكات مرنة في بيئات محدودة البنية التحتية
- سيناريوهات النشر السريع (الاستجابة للطوارئ، التثبيتات المؤقتة)
- التطبيقات من نظير إلى نظير التي تحافظ على الخصوصية

تعالج عُقدة هذه المتطلبات من خلال نهج مختلف جوهرياً لتوجيه الشبكة وتنظيمها.

### 1.2 فلسفة التصميم

عُقدة مبنية على ثلاثة مبادئ أساسية:

1. **اللامركزية افتراضياً**: لا سلطات مركزية، أو منسقين، أو نقاط فشل واحدة
2. **البساطة في التشغيل**: يجب أن تتشكل الشبكات تلقائياً مع تدخل بشري أدنى
3. **الأداء العملي**: يجب أن تخضع الأناقة النظرية لقابلية الاستخدام في العالم الحقيقي

### 1.3 العلاقة مع شبكة Yggdrasil

عُقدة Core هو **عمل مشتق** من بروتوكول شبكة Yggdrasil (v0.5)، يُحافظ عليه كمشروع مستقل مع التركيز على:

- **تحسينات الأداء** للنشر في الإنتاج
- **تحسينات تشغيلية** بناءً على الاستخدام العملي
- **أدوات محسّنة** للمراقبة والتشخيص

**التوافق مع البروتوكول**: عقد عُقدة متوافقة مع البروتوكول مع عقد Yggdrasil v0.5 ويمكنها الاتصال معها بسلاسة.

**الحوكمة**: تعمل عُقدة كمشروع مستقل بدورة إصدار خاصة بها، وأولويات، وخارطة طريق تطوير.

معلومات الاعتراف والترخيص الكاملة: [ATTRIBUTION.md](../ATTRIBUTION.md)

---

## 2. نظرة عامة على البنية

### 2.1 نموذج الشبكة

تعمل عُقدة كشبكة **overlay** تعمل فوق البنية التحتية IP الموجودة، رغم أن تصميم البروتوكول لا يتطلب بشكل أساسي تشغيل overlay.

كل عُقدة شبكة تتكون من:

- **عملية موجه في مساحة المستخدم**: موجه برمجي بعملية واحدة
- **واجهة TUN افتراضية**: حقن/استخراج حزم IPv6 لنظام التشغيل المضيف
- **طبقة الاتصال بالأقران**: إدارة الاتصال مع العقد المجاورة
- **محرك التوجيه**: اكتشاف المسار ومنطق إعادة توجيه الحزم
- **واجهة إدارية**: مقبس المراقبة والتحكم

### 2.2 مساواة العقد

جميع العقد **متكافئة وظيفياً**. لا توجد:

- عقد جذر (رغم أن بناء الشجرة الممتدة ينتج جذوراً عابرة)
- عقد فائقة أو منسقين مميزين
- عقد بوابة (ما لم يتم تكوينها صراحة لخدمات محددة)

يمكن لكل عُقدة في نفس الوقت:

- إنشاء حركة مرور
- استقبال حركة مرور موجهة إليها
- إعادة توجيه حركة مرور نيابة عن عقد أخرى

---

## 3. الهوية والعناونة

### 3.1 الهوية المشفرة

تمتلك كل عُقدة **زوج مفتاح عام/خاص** (Ed25519):

- **المفتاح العام** يخدم كهوية العُقدة الحقيقية
- يبقى المفتاح الخاص سرياً ويُستخدم لتوقيع رسائل البروتوكول

### 3.2 توليد عنوان IPv6

يتم **اشتقاق** عنوان IPv6 مستقر **بشكل حتمي** من المفتاح العام:

```
عنوان IPv6 = truncate(hash(public_key))
```

هذا يوفر:

- **الاستقلال عن الموقع**: العنوان مربوط بالهوية، وليس موقع الشبكة
- **الحركة**: تحتفظ العقد بعناوينها أثناء انتقالها عبر الشبكة
- **لا تخصيص مركزي**: لا DHCP، لا سجلات عناوين، لا تنسيق مطلوب

### 3.3 توافق التطبيقات

معظم التطبيقات القادرة على IPv6 تعمل على عُقدة **بدون تعديل**، حيث تقدم الشبكة عناوين IPv6 قياسية لنظام التشغيل المضيف.

---

## 4. بروتوكول التوجيه

### 4.1 أهداف التصميم

يجب أن يلبي نظام التوجيه:

- **حالة دنيا**: يجب ألا تحافظ العقد على جداول توجيه كاملة
- **التقارب التلقائي**: اكتشاف المسارات بدون إعداد يدوي
- **الاستعادة السريعة**: تكيف سريع مع تغيرات الطوبولوجيا
- **القابلية للتوسع**: تشغيل فعال مع نمو حجم الشبكة

### 4.2 نهج التوجيه

تستخدم عُقدة **مخطط توجيه هجين**:

1. **بناء الشجرة الممتدة** للتنسيق ورسائل التمهيد
2. **التوجيه الجشع في فضاء المفاتيح** باستخدام مبادئ جدول التجزئة الموزع
3. **التوجيه المصدر** للمسارات المحسّنة عند التوفر

#### الشجرة الممتدة

- توفر مزامنة عالمية
- تمكن تخصيص إحداثيات للعقد
- تُستخدم كآلية توجيه احتياطية
- اختيار الجذر بناءً على المفتاح العام (الأقل يفوز)

#### توجيه فضاء المفاتيح

- تتبادل العقد مرشحات bloom تصف نطاقات المفاتيح القابلة للوصول
- تملأ العقد المتوسطة جداول التوجيه بمسارات فضاء المفاتيح
- تُعاد توجيه الحزم نحو موقع الوجهة في فضاء المفاتيح

#### تحسين المسار

- يثبت توجيه الشجرة الاتصال الأولي
- تُكتشف مسارات أقصر من خلال توجيه فضاء المفاتيح المباشر
- تُستخدم المسارات المصدر عندما تكون أكثر كفاءة من توجيه فضاء المفاتيح
- العودة التلقائية إلى توجيه الشجرة إذا فشل المسار المحسّن

### 4.3 أمان البروتوكول

جميع رسائل التوجيه **موقعة مشفرياً** لمنع:

- التزوير
- العبث
- هجمات حقن المسار

---

## 5. الاتصال بالأقران والتوصيلية

### 5.1 إنشاء الاتصال بالأقران

تنشئ العقد اتصالات الأقران من خلال آليتين:

#### الاتصال الثابت
- إعداد يدوي لعناوين الأقران
- مستمر عبر إعادة التشغيل
- يمكن أن يعمل على أي نقل IP (LAN، WAN، الإنترنت)

#### اكتشاف البث المتعدد
- اكتشاف تلقائي للأقران على الشبكات المحلية
- إعلانات بث متعدد على مستوى الرابط
- تشغيل "plug-and-play" بدون إعدادات

### 5.2 النقل

اتصالات الأقران تدعم:

- **TCP** (مع TLS اختياري)
- **QUIC** (في التطبيقات التجريبية)
- نقل **IPv4 أو IPv6**

### 5.3 عبور NAT

تتعامل عُقدة مع بيئات NAT بسلاسة:

- اتصالات الأقران **ثنائية الاتجاه** بمجرد إنشائها
- لا حاجة لإعادة توجيه المنافذ للاتصالات الصادرة
- العقد خلف NAT تبقى قابلة للوصول بالكامل داخل شبكة عُقدة
- فعالة حتى مع NAT على مستوى الناقل (CGNAT)

---

## 6. نموذج الأمان

### 6.1 نموذج التهديد

تفترض عُقدة:

- **أعداء الشبكة**: قد تكون أي عُقدة أو رابط اتصال خاضعاً لسيطرة مهاجم
- **المراقبة السلبية**: قد تُراقب حركة المرور في أي نقطة
- **التدخل النشط**: قد تُسقط الحزم، أو تُؤخر، أو يُعاد ترتيبها

عُقدة **لا** تحاول إخفاء:

- علاقات الاتصال بالأقران (من يتصل بمن)
- أنماط حركة المرور أو التوقيت
- هويات المصدر والوجهة

### 6.2 الحماية المشفرة

جميع حركة المرور **مشفرة من طرف إلى طرف**:

- يستخدم التشفير المفتاح العام للوجهة
- السرية الأمامية من خلال تبادل مفاتيح عابر
- لا يمكن للعقد المتوسطة فك تشفير الحمولة
- المصادقة تمنع انتحال الشخصية

### 6.3 ما ليست عليه عُقدة

**عُقدة ليست شبكة إخفاء هوية.** لا توفر:

- إخفاء هوية حركة المرور
- التوجيه البصلي
- الخدمات المخفية
- عدم إمكانية ربط الاتصالات

يمكن للأقران المباشرين مراقبة عناوين IP وقد يستنتجون الموقع أو الهوية.

### 6.4 حالة التدقيق الأمني

**الحالة الحالية**: عُقدة **لم تخضع لتدقيق أمني مستقل**.

الكود يرث تطبيقات التشفير من:
- مكتبة Go القياسية (مدققة)
- شبكة Yggdrasil (مراجعة مجتمعية منذ 2017)

**التوصيات**:
- لا تستخدم للتطبيقات عالية الأمان بدون مراجعة مستقلة
- افترض وجود ثغرات غير مكتشفة
- الدفاع المتعدد الطبقات: استخدم التشفير على مستوى التطبيق للبيانات الحساسة

**مخطط**: تدقيق ممول من المجتمع مجدول لـ Q2 2026.

---

## 7. تحسينات الأداء

تدمج عُقدة تحسينات عملية بناءً على خبرة النشر في العالم الحقيقي:

### 7.1 إنشاء الاتصال

- **تقليل مهلة المصافحة**: 5s (محسّن من 6s)
- **اتصال TCP أسرع**: مهلة 3s
- **خوارزمية backoff تكيفية**:
  - المحاولة الأولى: 100ms
  - المحاولة الثانية: 250ms
  - المحاولة الثالثة: 500ms
  - أسي بعد ذلك

### 7.2 تخزين DNS مؤقت

- عمليات البحث الناجحة مخزنة لمدة 5 دقائق
- عمليات البحث الفاشلة مخزنة لمدة 30 ثانية
- يقلل زمن الاستجابة بمقدار 10-30ms لكل اتصال

### 7.3 مهلات البروتوكول

- WebSocket: مهلة قراءة/كتابة 5s
- مقبس UNIX: مهلة 2s
- محسّن للاستجابة دون التضحية بالموثوقية

### 7.4 مقارنة الأداء

| المقياس | الأساسي (Yggdrasil 0.5.12) | عُقدة 0.1.1 | التحسين |
|--------|------------------------------|------------|-------------|
| مهلة المصافحة | 6s | 5s | -16.7% |
| مهلة اتصال TCP | 5s | 3s | -40% |
| تأخير إعادة الاتصال الأولى | 1s | 100ms | -90% |
| إنشاء الاتصال | 50-100ms | 20-40ms | أسرع بنحو 60% |
| عبء DNS (غير مخزن مؤقت) | 30-50ms | <10ms | تقليل بنحو 75% |
| وقت إعادة الاتصال | 1-1.5s | 500-900ms | أسرع بنحو 50% |

**التأثير العملي**: في شبكة من 10 قفزات مع 3 أعطال مؤقتة في الساعة، تقلل هذه التحسينات متوسط زمن الاستجابة من طرف إلى طرف بمقدار 35-55ms وتحسن الاستجابة المحسوسة للمستخدم بشكل كبير.

---

## 8. الخصائص التشغيلية

### 8.1 استهلاك عرض النطاق

العقد مع اتصالات أقران متعددة ستعيد **توجيه حركة المرور للآخرين**:

- عبء البروتوكول ضئيل (تبادلات مرشح bloom، صيانة الشجرة)
- إعادة توجيه البيانات متناسبة مع موقع الشبكة والتوصيلية
- قائمة انتظار عادلة للحزم تمنع تشبع عُقدة واحدة

### 8.2 معالجة MTU

تستخدم عُقدة **قيم MTU عالية** (حتى 65535) على واجهات TUN:

- اتصالات الأقران القائمة على التدفق تقضي على مشاكل التجزئة
- يقلل عبء استدعاءات النظام
- يحسن الإنتاجية ويقلل استخدام CPU
- يخفف تضخيم TCP-over-TCP

### 8.3 توصيات جدار الحماية

كشبكة **عامة**، عقد عُقدة قابلة للوصول عالمياً افتراضياً.

**موصى به بشدة**: نشر قواعد جدار حماية IPv6 لـ:

- حظر الاتصالات الواردة غير المتوقعة
- منع تعرض الخدمات
- تطبيق مبدأ أقل امتياز

### 8.4 أفضل ممارسات النشر

#### إعداد جدار الحماية

**الوضع الأمني الأدنى** (جميع المنصات):
- حظر جميع حركة مرور IPv6 الواردة على واجهة عُقدة افتراضياً
- السماح فقط بالاتصالات المؤسسة/المرتبطة
- إدراج الخدمات المطلوبة صراحة في القائمة البيضاء

#### اختيار الأقران

**للشبكات المستقرة:**
- اختر أقراناً قريبين جغرافياً لتقليل زمن الاستجابة
- حافظ على 2-4 أقران ثابتين للاحتياط
- تجنب الاتصال المفرط بالأقران (عوائد متناقصة بعد 5-6 أقران)

**للحالات المتنقلة/الديناميكية:**
- تفعيل اكتشاف البث المتعدد
- استخدام أقران عامين كاحتياط
- قبول زمن استجابة أعلى للراحة

#### المراقبة

مقاييس أساسية للمتابعة:
- عدد الأقران النشطين (`uqdactl getPeers`)
- حجم جدول التوجيه
- عبء حركة مرور البروتوكول
- استقرار الاتصال (تكرار إعادة الاتصال)

---

## 9. حالات الاستخدام

### 9.1 شبكات Mesh المجتمعية

- أحياء تبني بنية تحتية مستقلة
- اتصال محلي مرن
- تقليل الاعتماد على مزودي خدمة الإنترنت

### 9.2 الحوسبة الطرفية

- اتصال مباشر بين الأجهزة
- معالجة محلية بزمن استجابة منخفض
- لا حاجة لوسيط سحابي

### 9.3 الشبكات الطارئة

- نشر سريع بدون بنية تحتية
- مرونة مع التوصيلية الجزئية
- اتصال عندما يكون الإنترنت غير متاح

### 9.4 البحث والتطوير

- تجربة البروتوكولات
- اختبار الأنظمة الموزعة
- بحث طوبولوجيا الشبكة

### 9.5 التطبيقات اللامركزية

- خدمات من نظير إلى نظير
- اتصال مقاوم للرقابة
- تطبيقات تحافظ على الخصوصية

---

## 10. القيود والأهداف غير المطلوبة

### 10.1 ليست بديلاً عن VPN

رغم أن عُقدة يمكن استخدامها للشبكات الخاصة، إلا أنها **غير مصممة كـ VPN تقليدي**:

- الاتصال بأقران عامين يربط الشبكات معاً
- لا وظيفة بوابة إنترنت مدمجة
- لا مفهوم عُقدة خروج

### 10.2 ليست نظام إخفاء هوية

عُقدة **لا توفر إخفاء الهوية**:

- الأقران يعرفون عناوين IP بعضهم البعض
- قد تكون أنماط حركة المرور قابلة للملاحظة
- لا حماية ضد تحليل حركة المرور

### 10.3 قيود مقياس التوجيه الحالي

**لماذا عدد القفزات فقط؟**

يُفضل البروتوكول **مقاييس قابلة للتحقق وغير قابلة للتلاعب**. قياسات جودة الرابط التفاعلية (RTT، مجسات عرض النطاق) يمكن أن تكون:

- مزيفة من قبل عقد خبيثة
- مكلفة للتحقق بشكل مستقل
- صعبة التأمين في بيئات معادية

**التأثير العملي:**

- قد تكون بعض اتصالات الأقران القائمة على الإنترنت دون المستوى الأمثل
- القرب المادي لا يضمن قرب التوجيه
- يجب على المستخدمين ضبط اتصالات الأقران يدوياً للسيناريوهات الحرجة للأداء

**العمل المستقبلي**: البحث في مقاييس الجودة الآمنة والقابلة للتحقق مستمر.

---

## 11. حالة المشروع وخارطة الطريق

### 11.1 الحالة الحالية

- **النضج**: تطوير نشط، جاهز للإنتاج للأحمال غير الحرجة
- **الاستقرار**: موثوق للنشر التجريبي والمجتمعي
- **غير موصى به**: التطبيقات الحرجة أو سلامة الحياة

### 11.2 التطوير المستقبلي

التحسينات المخططة تشمل:

- تحسينات توجيه متقدمة
- أدوات مراقبة وتشخيص محسّنة
- تحليلات أداء محسّنة
- دعم منصات أوسع
- تطور بروتوكول محتمل مع ظهور المتطلبات

---

## 12. المواصفات التقنية

### 12.1 إصدار البروتوكول

- الإصدار الحالي: **متوافق مع 0.5**
- التوافق مع الإصدارات السابقة محفوظ عبر الإصدارات الثانوية

### 12.2 التشفير

- **التوقيع**: Ed25519
- **تبادل المفاتيح**: X25519
- **التشفير**: ChaCha20-Poly1305

### 12.3 مساحة العناوين

- **نطاق IPv6**: `0200::/7` (نطاق مهمل من IETF، لا تعارض مع ULA)

### 12.4 المنصات المدعومة

- Linux (نواة 3.x+)
- Windows (7+)
- macOS (10.12+)
- FreeBSD (تجريبي)

---

## 13. التحليل المقارن

| الميزة | عُقدة | Yggdrasil | Tailscale | Nebula | I2P/Tor |
|---------|------|-----------|-----------|--------|---------|
| لامركزي | ✅ | ✅ | ❌ (منسق) | ❌ (منارة) | ✅ |
| شبكة mesh بدون إعدادات | ✅ | ✅ | ⚠️ (مدار) | ⚠️ (PKI يدوي) | ❌ |
| التشفير على مستوى البروتوكول | ✅ | ✅ | ✅ | ✅ | ✅ |
| إخفاء الهوية | ❌ | ❌ | ❌ | ❌ | ✅ |
| عبور NAT | ✅ (ثنائي الاتجاه) | ✅ | ✅ (STUN/نقل) | ⚠️ (محدود) | ✅ |
| التركيز على الأداء | ✅ | ⚠️ | ✅ | ✅ | ❌ (زمن استجابة عالي) |
| يعمل بدون إنترنت | ✅ | ✅ | ❌ | ⚠️ | ❌ |
| جاهز للإنتاج | ⚠️ (غير حرج) | ⚠️ (ألفا) | ✅ | ✅ | ✅ |

**الشرح**: ✅ دعم كامل | ⚠️ جزئي/محدود | ❌ غير مدعوم

---

## 14. الخلاصة

تمثل عُقدة **تطوراً يركز على الإنتاج** لمبادئ التوجيه اللامركزي المثبتة، محسّنة لـ:

- **الأداء في العالم الحقيقي**: تحسينات زمن استجابة قابلة للقياس
- **البساطة التشغيلية**: عبء إعداد أدنى
- **النشر العملي**: الشبكات المجتمعية، الحوسبة الطرفية، البحث

### ليست حلاً سحرياً

عُقدة **لا** تحل جميع مشاكل الشبكات. إنها:

- **ليست** بديلاً عن الإنترنت
- **ليست** نظام إخفاء هوية
- **ليست** جاهزة للتطبيقات الحرجة (بعد)

### ما تمكنه عُقدة

- **ملكية المجتمع** لبنية الشبكة التحتية
- **اتصال مباشر** بدون وسطاء
- **اتصال مرن** في ظروف معاكسة
- **أساس للتطبيقات اللامركزية**

### انضم إلينا

- **الوثائق**: `https://github.com/Uqda/Core`
- **الكود المصدري**: `https://github.com/Uqda/Core`
- **المجتمع**: انضم للمناقشات على GitHub

تعيد عُقدة السيطرة على بنية الشبكة التحتية لمستخدميها.  
**ابن الشبكة التي تحتاجها. املك الشبكة التي تبنيها.**

---

## المراجع

- بحث البروتوكول الأصلي: مشروع Yggdrasil Network
- بدائيات التشفير: libsodium، مكتبة Go القياسية
- بحث طوبولوجيا الشبكة: منشورات متنوعة حول جداول التجزئة الموزعة والأشجار الممتدة

---

## الاعتراف

عُقدة Core مبنية على بروتوكول Yggdrasil Network، مع تحسينات تنفيذ كبيرة وتحسينات تشغيلية. راجع [ATTRIBUTION.md](../ATTRIBUTION.md) للاعتمادات الكاملة.

---

**إصدار الوثيقة**: 1.0  
**آخر تحديث**: يناير 2026  
**الاتصال**: uqda@proton.me  
**الترخيص**: راجع ملف LICENSE في المستودع

